(function(){"use strict";var e=new springroll.ApplicationPlugin;e.preload=function(e){var i=function(e,i){return e instanceof Function&&e.bind(this)(i)||e}.bind(this);var t={options:{}};var n=function(e){Object.keys(e).forEach(function(i){if(i==="options"){Object.keys(e[i]).forEach(function(n){t.options[n]=e[i][n]})}else{t[i]=e[i]}})};if(this.config.alp){n(this.config.alp)}if(this.options.alp){n(this.options.alp)}var a=t.recType;var r=t.recParams;var o=t.recCallback;var s=t.gameUri;var c=t.eventOverride;var l=this.learning.catalog.events||{};KidaptiveSdk.init(t.apiKey,t.version,t.options).then(function(t){var n={};this.alpPlugin={sdk:t,getRecommendation:function(e){var n=t.KidaptiveUtils.copyObject(i(a,e)||"optimalDifficulty");var c=t.KidaptiveUtils.copyObject(i(r,e))||{};c.learnerId=t.getLearnerList()[0].id;c.game=s;var l;switch(n){case"random":l=t.getRandomRecommendations(c);break;case"optimalDifficulty":l=t.getOptimalDifficultyRecommendations(c);break;default:l=t.getRecommendations(n,c)}return o?o.bind(this)(l,e):l}.bind(this),getState:function(){return t.KidaptiveUtils.copyObject(n)},setState:function(e){Object.keys(e).forEach(function(i){if(e[i]===undefined){delete n[i]}});e=t.KidaptiveUtils.copyObject(e);Object.keys(e).forEach(function(i){n[i]=e[i]})}};if(this.learning){var d=function(e){if(!t.getCurrentUser()){return}var i=l[e.event_data.event_code]||"Springroll Event";var n=t.KidaptiveUtils.copyObject(e.event_data);var a={additionalFields:n};a.gameUri=s;a.learnerId=t.getLearnerList()[0].id;for(var r in n){if(r==="duration"&&typeof n[r]==="number"){a[r]=n[r]/1e3;delete n[r]}else if(n[r]instanceof Object){n[r]=t.KidaptiveUtils.toJson(n[r])}else{n[r]=n[r].toString()}}n.springroll_game_id=e.game_id;n.springroll_event_id=e.event_id;n.springroll_event_code=n.event_code;delete n.event_code;t.reportBehavior(i,a)};var f=c||d;this.learning.on("learningEvent",function(e){f.bind(this)(e,d)}.bind(this))}e()}.bind(this))};e.teardown=function(){this.alpPlugin.sdk.destroy().then(function(){delete this.alpPlugin}.bind(this))}})();

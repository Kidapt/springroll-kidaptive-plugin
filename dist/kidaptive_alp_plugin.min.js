(function(){"use strict";var t=new springroll.ApplicationPlugin;t.preload=function(t){var e=function(t,e){return t instanceof Function&&t.bind(this)(e)||t}.bind(this);var i={options:{}};var n=function(t){Object.keys(t).forEach(function(e){if(e==="options"){Object.keys(t[e]).forEach(function(n){i.options[n]=t[e][n]})}else{i[e]=t[e]}})};if(this.config.alp){n(this.config.alp)}if(this.options.alp){n(this.options.alp)}var o=i.recType;var a=i.recParams;var r=i.recCallback;var s=i.gameUri;var c=i.eventOverride;var d=this.learning.catalog.events||{};KidaptiveSdk.init(i.apiKey,i.version,i.options).then(function(n){var l={};this.alpPlugin={sdk:n,getRecommendation:function(t){var i=n.KidaptiveUtils.copyObject(e(o,t)||"optimalDifficulty");var c=n.KidaptiveUtils.copyObject(e(a,t))||{};c.learnerId=n.getLearnerList()[0].id;c.game=s;var d;switch(i){case"random":d=n.getRandomRecommendations(c);break;case"optimalDifficulty":d=n.getOptimalDifficultyRecommendations(c);break;default:d=n.getRecommendations(i,c)}return r?r.bind(this)(d,t):d}.bind(this),getState:function(){return n.KidaptiveUtils.copyObject(l)},setState:function(t){Object.keys(t).forEach(function(e){if(t[e]===undefined){delete l[e]}});t=n.KidaptiveUtils.copyObject(t);Object.keys(t).forEach(function(e){l[e]=t[e]})},getInitParams:function(){return KidaptiveSdk.KidaptiveUtils.copyObject(i,true)}};if(!i.options.noOidc&&this.container){var u=function(t){if(n.KidaptiveUtils.getObject(t,["data","name"])!=="Kidaptive ALP"){return}n.init().then(function(){var t=n.KidaptiveUtils.getObject(n.getCurrentUser(),"id");if(n.isAnonymousSession()){n.logoutUser()}n.refresh().then(function(){var e=n.KidaptiveUtils.getObject(n.getCurrentUser(),"id");if(!e||e!==t){l={}}})})};var f=function(t){if(n.KidaptiveUtils.getObject(t,["data","name"])!=="Kidaptive ALP"){return}n.init().then(function(){if(!n.isAnonymousSession()){n.logoutUser().then(function(){l={}})}})};var p=function(){n.init().then(function(){if(n.isAnonymousSession()){n.logoutUser()}n.logoutUser().then(function(){l={}})})};this.container.on("openIdAuthSuccess",u);this.container.on("openIdRefreshAuthSuccess",u);this.container.on("openIdAuthFailure",f);this.container.on("openIdRefreshAuthFailure",f);this.container.on("openIdAllLogoutsComplete",p)}if(this.learning){var v=function(t){if(!n.getCurrentUser()){return}var e=d[t.event_data.event_code]||"Springroll Event";var i=n.KidaptiveUtils.copyObject(t.event_data);var o={additionalFields:i};o.gameUri=s;o.learnerId=n.getLearnerList()[0].id;for(var a in i){if(a==="duration"&&typeof i[a]==="number"){o[a]=i[a]/1e3;delete i[a]}else if(i[a]instanceof Object){i[a]=n.KidaptiveUtils.toJson(i[a])}else{i[a]=i[a].toString()}}i.springroll_game_id=t.game_id;i.springroll_event_id=t.event_id;i.springroll_event_code=i.event_code;delete i.event_code;n.reportBehavior(e,o)};var h=(c||v).bind(this);this.learning.on("learningEvent",function(t){h(t,v)}.bind(this))}t()}.bind(this))};t.teardown=function(){this.alpPlugin.sdk.destroy().then(function(){delete this.alpPlugin}.bind(this))}})();

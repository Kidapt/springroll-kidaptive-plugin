(function(){"use strict";var e=new springroll.ApplicationPlugin;e.preload=function(e){var i=function(e,i){return e instanceof Function&&e.bind(this)(i)||e}.bind(this);var t={options:{}};var n=function(e){Object.keys(e).forEach(function(i){if(i==="options"){Object.keys(e[i]).forEach(function(n){t.options[n]=e[i][n]})}else{t[i]=e[i]}})};if(this.config.alp){n(this.config.alp)}if(this.options.alp){n(this.options.alp)}var a=t.recType;var r=t.recParams;var o=t.recCallback;var s=t.gameUri;var c=t.eventOverride;var d=this.learning.catalog.events||{};KidaptiveSdk.init(t.apiKey,t.version,t.options).then(function(n){var l={};this.alpPlugin={sdk:n,getRecommendation:function(e){var t=n.KidaptiveUtils.copyObject(i(a,e)||"optimalDifficulty");var c=n.KidaptiveUtils.copyObject(i(r,e))||{};c.learnerId=n.getLearnerList()[0].id;c.game=s;var d;switch(t){case"random":d=n.getRandomRecommendations(c);break;case"optimalDifficulty":d=n.getOptimalDifficultyRecommendations(c);break;default:d=n.getRecommendations(t,c)}return o?o.bind(this)(d,e):d}.bind(this),getState:function(){return n.KidaptiveUtils.copyObject(l)},setState:function(e){Object.keys(e).forEach(function(i){if(e[i]===undefined){delete l[i]}});e=n.KidaptiveUtils.copyObject(e);Object.keys(e).forEach(function(i){l[i]=e[i]})},getInitParams:function(){return KidaptiveSdk.KidaptiveUtils.copyObject(t,true)}};if(this.learning){var v=function(e){if(!n.getCurrentUser()){return}var i=d[e.event_data.event_code]||"Springroll Event";var t=n.KidaptiveUtils.copyObject(e.event_data);var a={additionalFields:t};a.gameUri=s;a.learnerId=n.getLearnerList()[0].id;for(var r in t){if(r==="duration"&&typeof t[r]==="number"){a[r]=t[r]/1e3;delete t[r]}else if(t[r]instanceof Object){t[r]=n.KidaptiveUtils.toJson(t[r])}else{t[r]=t[r].toString()}}t.springroll_game_id=e.game_id;t.springroll_event_id=e.event_id;t.springroll_event_code=t.event_code;delete t.event_code;n.reportBehavior(i,a)};var f=c||v;this.learning.on("learningEvent",function(e){f.bind(this)(e,v)}.bind(this))}e()}.bind(this))};e.teardown=function(){this.alpPlugin.sdk.destroy().then(function(){delete this.alpPlugin}.bind(this))}})();
